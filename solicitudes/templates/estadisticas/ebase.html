{% comment %} 
Plantilla base para generar vistas de estadisticas con envolvimiento automatico 
no es necesario heredar de ella si se busca otra cosa o se quiere contruir la propia desde 0
{% endcomment %} 

{% load static %}

<script>
    function dibujarGrafico(idCanvas, grafico){
        var ctx = document.getElementById(idCanvas).getContext('2d');
        var myChart = new Chart(ctx, grafico);
    }
</script>

<div class="m-5 mt-0">
    {% block panelOpciones %}

    {% if estadSelectForm and urlEstaditica %}
        <div class="row">
            <div class="col">
                {{ estadSelectForm.estadistica_filtro.label }}            
                {{ estadSelectForm.estadistica_filtro }}            
            </div>
            <div class="col">
                {{ estadSelectForm.campo_estadistica.label }}    
                {{ estadSelectForm.campo_estadistica }}    
            </div>
        </div>

        <script>
            $(document).ready(function() {

                $('.EstadInfoSelect').on('change', function() {
                    var valoresSeleccionados = {};
                    // Recorre todos los selects con la clase EstadInfoSelect
                    $('.EstadInfoSelect').each(function() {
                        var nombreSelect = $(this).attr('name');
                        var valorSeleccionado = $(this).val();
                        valoresSeleccionados[nombreSelect] = valorSeleccionado;
                    });
                    cargarEstadistica('{% url urlEstaditica %}', valoresSeleccionados)
                });

            });
        </script>
    {% endif %}

    {% endblock panelOpciones %}
</div>


<div id="contMosaico-{{ forloop.counter0 }}" class="contenedor-mosaico">    
    {% for conjuntoEst in conjuntosEstadisticos %}
        <div class="tile">  
            {% if conjuntoEst.grafico %}
                {% with conjuntoEst.grafico as grafico %}                            
                        <canvas id="grafico-{{ forloop.counter0 }}"></canvas>
                        {% with flc=forloop.counter0|stringformat:"s" %}
                        {% with 'grafico-json-'|add:flc as idg %}
                            {{ grafico|json_script:idg }}                                      
                            <script>dibujarGrafico("grafico-{{ forloop.counter0 }}", JSON.parse(document.getElementById('{{idg}}').textContent))</script>                                
                        {% endwith %}
                        {% endwith %}                      
                {% endwith %}
            {% elif conjuntoEst.tipo == 'Leyenda' %}
                <div class="font-sm " >
                    <div class="font-md font-semi-bold">
                        {{ conjuntoEst.dataLabel }}
                    </div>
                    <div class="overflow-auto" style="max-height: 300px;">
                        {% for color, label, frecuencia in conjuntoEst.data %}
                        <div class="row mx-0 px-0">
                            <div class="col-1 p-1" >
                                <div class="w-100 h-100" style="background-color: rgb({{ color.0 }}, {{ color.1 }}, {{ color.2 }});"> </div>
                            </div>
                            <div class="col-auto px-2">
                                {{ label }}:
                            </div>
                            <div class="col-2 px-1 font-semi-bold">
                                {{ frecuencia }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>                    
                </div>     
            {% else %}
                <div class="font-sm " >
                    <div class="font-md font-semi-bold mb-1">
                        {{ conjuntoEst.dataLabel }}
                    </div>
                    <div class="overflow-auto" style="max-height: 300px;">
                        <div class="row row-cols-auto mx-0 px-0">
                        {% for linea in conjuntoEst.data %}                        
                            <div class="col-auto p-0">
                                <div class="row mx-0 px-0">
                                    {% for dato in linea %}                                    
                                    <div class="col-auto px-1 {%if forloop.last%}font-semi-bold{%endif%}">
                                        {{ dato }}
                                    </div>                                    
                                    {% endfor %}
                                </div>
                            </div>                        
                        {% endfor %}
                        </div>
                    </div>                    
                </div>   
            {% endif %}
        </div>
    {% endfor %}
</div>